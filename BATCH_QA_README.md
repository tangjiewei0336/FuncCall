# æ‰¹é‡é—®ç­”å¤„ç†å·¥å…·ä½¿ç”¨æŒ‡å—

æœ¬å·¥å…·å¯ä»¥ä»Excelæ–‡ä»¶è¯»å–é—®é¢˜åˆ—è¡¨ï¼Œè‡ªåŠ¨è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå›å¤ï¼Œå¹¶ä¿å­˜ç»“æœåˆ°æ–°çš„Excelæ–‡ä»¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š **Excelæ‰¹é‡å¤„ç†**: ä»Excelæ–‡ä»¶è¯»å–é—®é¢˜åˆ—è¡¨
- ğŸ¤– **æ™ºèƒ½é—®ç­”**: è‡ªåŠ¨è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå›å¤
- ğŸ“š **RAGæ£€ç´¢**: è‡ªåŠ¨ä½¿ç”¨çŸ¥è¯†åº“æŸ¥è¯¢å·¥å…·è·å–æƒå¨ä¿¡æ¯
- ğŸ’¾ **ç»“æœä¿å­˜**: è‡ªåŠ¨ä¿å­˜å¤„ç†ç»“æœåˆ°Excelæ–‡ä»¶
- ğŸ“ˆ **è¿›åº¦è·Ÿè¸ª**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦å’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ”„ **æ–­ç‚¹ç»­ä¼ **: å®šæœŸä¿å­˜ä¸­é—´ç»“æœï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 

## å®‰è£…ä¾èµ–

```bash
pip install pandas openpyxl
```

## ä½¿ç”¨æ–¹æ³•

### 1. åˆ›å»ºç¤ºä¾‹Excelæ–‡ä»¶

```bash
python batch_qa_processor.py --create-sample
```

è¿™å°†åˆ›å»ºä¸€ä¸ª`sample_questions.xlsx`æ–‡ä»¶ï¼ŒåŒ…å«ç¤ºä¾‹é—®é¢˜ã€‚

### 2. å‡†å¤‡è¾“å…¥Excelæ–‡ä»¶

Excelæ–‡ä»¶æ ¼å¼è¦æ±‚ï¼š
- å¿…é¡»åŒ…å«ä¸€ä¸ªåä¸º"é—®é¢˜"çš„åˆ—ï¼ˆå¯é€šè¿‡å‚æ•°è‡ªå®šä¹‰ï¼‰
- æ¯è¡Œä¸€ä¸ªé—®é¢˜
- æ”¯æŒå…¶ä»–åˆ—ä½œä¸ºå¤‡æ³¨ä¿¡æ¯

ç¤ºä¾‹æ ¼å¼ï¼š
| é—®é¢˜ | å¤‡æ³¨ |
|------|------|
| HPVç–«è‹—çš„å‰¯ä½œç”¨æœ‰å“ªäº›ï¼Ÿ | ç¤ºä¾‹é—®é¢˜1 |
| äºŒä»·ç–«è‹—å’Œå››ä»·ç–«è‹—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ | ç¤ºä¾‹é—®é¢˜2 |

### 3. è¿è¡Œæ‰¹é‡å¤„ç†

#### åŸºæœ¬ç”¨æ³•
```bash
python batch_qa_processor.py input_questions.xlsx
```

#### é«˜çº§ç”¨æ³•
```bash
python batch_qa_processor.py input_questions.xlsx \
    -o output_results.xlsx \
    -c "é—®é¢˜" \
    -b 5 \
    -d 2.0
```

#### å‚æ•°è¯´æ˜
- `input_file`: è¾“å…¥Excelæ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
- `-o, --output`: è¾“å‡ºExcelæ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤è‡ªåŠ¨ç”Ÿæˆï¼‰
- `-c, --column`: é—®é¢˜åˆ—åï¼ˆé»˜è®¤ï¼šé—®é¢˜ï¼‰
- `-b, --batch`: æ‰¹å¤„ç†å¤§å°ï¼ˆé»˜è®¤ï¼š10ï¼‰
- `-d, --delay`: è¯·æ±‚é—´éš”æ—¶é—´ï¼ˆç§’ï¼Œé»˜è®¤ï¼š1.0ï¼‰
- `--create-sample`: åˆ›å»ºç¤ºä¾‹Excelæ–‡ä»¶

### 4. æŸ¥çœ‹ç»“æœ

å¤„ç†å®Œæˆåï¼Œä¼šç”ŸæˆåŒ…å«ä»¥ä¸‹åˆ—çš„Excelæ–‡ä»¶ï¼š
- **åºå·**: é—®é¢˜åºå·
- **é—®é¢˜**: åŸå§‹é—®é¢˜
- **å›ç­”**: å¤§æ¨¡å‹ç”Ÿæˆçš„å›ç­”
- **å‚è€ƒæ–‡çŒ®**: æå–çš„å‚è€ƒæ–‡çŒ®ä¿¡æ¯
- **å¤„ç†æ—¶é—´**: å¤„ç†æ—¶é—´æˆ³
- **çŠ¶æ€**: å¤„ç†çŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºæœ¬æ‰¹é‡å¤„ç†

```bash
# åˆ›å»ºç¤ºä¾‹æ–‡ä»¶
python batch_qa_processor.py --create-sample

# å¤„ç†ç¤ºä¾‹æ–‡ä»¶
python batch_qa_processor.py sample_questions.xlsx
```

### ç¤ºä¾‹2: è‡ªå®šä¹‰å‚æ•°

```bash
python batch_qa_processor.py my_questions.xlsx \
    -o my_results.xlsx \
    -c "é—®é¢˜å†…å®¹" \
    -b 20 \
    -d 1.5
```

### ç¤ºä¾‹3: ç¨‹åºåŒ–è°ƒç”¨

```python
from batch_qa_processor import BatchQAProcessor

# åˆ›å»ºå¤„ç†å™¨
processor = BatchQAProcessor()

# å¤„ç†Excelæ–‡ä»¶
result = processor.process_excel_file(
    input_file="questions.xlsx",
    output_file="results.xlsx",
    question_column="é—®é¢˜",
    batch_size=10,
    delay_between_requests=1.0
)

print(result)
```

## è¾“å‡ºç»“æœç¤ºä¾‹

### æˆåŠŸå¤„ç†çš„å›ç­”ç¤ºä¾‹
```
HPVç–«è‹—çš„å‰¯ä½œç”¨ä¸»è¦åŒ…æ‹¬æ³¨å°„éƒ¨ä½ç–¼ç—›ã€çº¢è‚¿ã€å‘çƒ­ç­‰è½»å¾®ååº”ï¼Œè¿™äº›ååº”é€šå¸¸åœ¨1-2å¤©å†…è‡ªè¡Œç¼“è§£ã€‚ä¸¥é‡çš„è¿‡æ•ååº”è¾ƒä¸ºç½•è§ã€‚

ä¿¡æ¯æ¥æºï¼š
[1] ä¸­å›½ç–¾ç—…é¢„é˜²æ§åˆ¶ä¸­å¿ƒ. HPVç–«è‹—å®‰å…¨æ€§ç›‘æµ‹æŠ¥å‘Š
[2] ä¸–ç•Œå«ç”Ÿç»„ç»‡. HPVç–«è‹—ç«‹åœºæ–‡ä»¶
```

### Excelè¾“å‡ºæ ¼å¼
| åºå· | é—®é¢˜ | å›ç­” | å‚è€ƒæ–‡çŒ® | å¤„ç†æ—¶é—´ | çŠ¶æ€ |
|------|------|------|----------|----------|------|
| 1 | HPVç–«è‹—çš„å‰¯ä½œç”¨æœ‰å“ªäº›ï¼Ÿ | HPVç–«è‹—çš„å‰¯ä½œç”¨ä¸»è¦åŒ…æ‹¬... | ä¿¡æ¯æ¥æºï¼š[1] ä¸­å›½ç–¾ç—…é¢„é˜²æ§åˆ¶ä¸­å¿ƒ... | 2024-01-15 10:30:25 | æˆåŠŸ |

## æ³¨æ„äº‹é¡¹

### 1. APIé™åˆ¶
- è¯·ç¡®ä¿è®¾ç½®äº†æ­£ç¡®çš„APIå¯†é’¥ï¼ˆDASHSCOPE_API_KEYç¯å¢ƒå˜é‡ï¼‰
- æ³¨æ„APIè°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®è®¾ç½®é€‚å½“çš„è¯·æ±‚é—´éš”

### 2. æ–‡ä»¶æ ¼å¼
- è¾“å…¥æ–‡ä»¶å¿…é¡»æ˜¯Excelæ ¼å¼ï¼ˆ.xlsxï¼‰
- ç¡®ä¿é—®é¢˜åˆ—åæ­£ç¡®
- æ”¯æŒä¸­æ–‡åˆ—å

### 3. å¤„ç†æ—¶é—´
- æ¯ä¸ªé—®é¢˜çš„å¤„ç†æ—¶é—´å–å†³äºå¤§æ¨¡å‹å“åº”é€Ÿåº¦
- å»ºè®®è®¾ç½®é€‚å½“çš„è¯·æ±‚é—´éš”é¿å…APIé™åˆ¶
- å¤§é‡é—®é¢˜å¤„ç†å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´

### 4. é”™è¯¯å¤„ç†
- å•ä¸ªé—®é¢˜å¤„ç†å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–é—®é¢˜
- å¤±è´¥çš„é—®é¢˜ä¼šåœ¨ç»“æœä¸­æ ‡è®°ä¸º"å¤±è´¥"çŠ¶æ€
- é”™è¯¯ä¿¡æ¯ä¼šè®°å½•åœ¨å›ç­”åˆ—ä¸­

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯**
   ```
   é”™è¯¯ï¼šè¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨: questions.xlsx
   ```
   è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

2. **åˆ—åé”™è¯¯**
   ```
   é”™è¯¯ï¼šæœªæ‰¾åˆ°åˆ— 'é—®é¢˜'ã€‚å¯ç”¨åˆ—ï¼š['é—®é¢˜å†…å®¹', 'å¤‡æ³¨']
   ```
   è§£å†³ï¼šä½¿ç”¨ `-c "é—®é¢˜å†…å®¹"` æŒ‡å®šæ­£ç¡®çš„åˆ—å

3. **APIå¯†é’¥é”™è¯¯**
   ```
   è°ƒç”¨æ¨¡å‹å¤±è´¥ï¼šAPIå¯†é’¥æœªè®¾ç½®
   ```
   è§£å†³ï¼šè®¾ç½®DASHSCOPE_API_KEYç¯å¢ƒå˜é‡

4. **å¤„ç†å¤±è´¥**
   ```
   âœ— å¤„ç†å¤±è´¥: ç½‘ç»œè¿æ¥é”™è¯¯
   ```
   è§£å†³ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå¢åŠ è¯·æ±‚é—´éš”æ—¶é—´

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ‰¹å¤„ç†å¤§å°**: æ ¹æ®APIé™åˆ¶è°ƒæ•´æ‰¹å¤„ç†å¤§å°
2. **è¯·æ±‚é—´éš”**: é¿å…APIé¢‘ç‡é™åˆ¶ï¼Œå»ºè®®1-2ç§’é—´éš”
3. **æ–‡ä»¶å¤§å°**: å¤§é‡é—®é¢˜å»ºè®®åˆ†æ‰¹å¤„ç†
4. **å†…å­˜ä½¿ç”¨**: å¤„ç†å¤§é‡é—®é¢˜æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨

## é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰å¤„ç†å™¨

```python
class CustomBatchQAProcessor(BatchQAProcessor):
    def _extract_references(self, answer: str) -> str:
        # è‡ªå®šä¹‰å‚è€ƒæ–‡çŒ®æå–é€»è¾‘
        return super()._extract_references(answer)
    
    def process_excel_file(self, input_file: str, **kwargs):
        # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        return super().process_excel_file(input_file, **kwargs)
```

### ç»“æœåˆ†æ

```python
# è·å–å¤„ç†ç»“æœ
results = processor.get_results()

# åˆ†ææˆåŠŸç‡
successful = len([r for r in results if r["çŠ¶æ€"] == "æˆåŠŸ"])
total = len(results)
success_rate = successful / total * 100

print(f"æˆåŠŸç‡: {success_rate:.1f}%")
```

## æ›´æ–°æ—¥å¿—

- v1.0.0: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬æ‰¹é‡å¤„ç†åŠŸèƒ½
- v1.1.0: æ·»åŠ å‚è€ƒæ–‡çŒ®æå–åŠŸèƒ½
- v1.2.0: æ”¯æŒè‡ªå®šä¹‰åˆ—åå’Œå‚æ•°
- v1.3.0: æ·»åŠ æ–­ç‚¹ç»­ä¼ å’Œè¿›åº¦è·Ÿè¸ª 